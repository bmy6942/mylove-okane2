<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ…ç§Ÿä»£ç®¡å¤–åŒ…è©¦ç®— - å°ˆæ¥­ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* åŸºç¤è¨­å®š */
        body { font-family: 'Microsoft JhengHei', -apple-system, BlinkMacSystemFont, sans-serif; background-color: #f8fafc; }
        
        /* ç§»é™¤æ•¸å­—è¼¸å…¥æ¡†çš„ä¸Šä¸‹ç®­é ­ */
        .no-spinner::-webkit-inner-spin-button, .no-spinner::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .no-spinner { -moz-appearance: textfield; }
        
        /* å‹•ç•«æ•ˆæœ */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* åˆ—å°æ™‚éš±è—æŒ‰éˆ• */
        @media print {
            .no-print { display: none !important; }
            body { background-color: white; }
            .shadow-lg, .shadow { box-shadow: none !important; border: 1px solid #ddd; }
        }

        /* --- ä¸»é¡Œè‰²ç³»å®šç¾© --- */
        
        /* ç´«è‰²ä¸»é¡Œ (åŒ…ç§Ÿ) */
        .theme-purple-bg { background-color: #6366f1; }
        .theme-purple-text { color: #6366f1; }
        .theme-purple-light-bg { background-color: #e0e7ff; }
        .border-purple { border-color: #6366f1; }

        /* ç¶ è‰²ä¸»é¡Œ (ä»£ç®¡) */
        .theme-green-bg { background-color: #10b981; }
        .theme-green-text { color: #10b981; }
        .theme-green-light-bg { background-color: #d1fae5; }
        .border-green { border-color: #10b981; }

        /* é ç±¤ç‹€æ…‹ */
        .tab-active-sublet { background-color: #6366f1; color: white; border-bottom: 3px solid #4338ca; }
        .tab-active-manage { background-color: #10b981; color: white; border-bottom: 3px solid #059669; }
        .tab-inactive { background-color: white; color: #64748b; border-bottom: 1px solid #e2e8f0; }
        .tab-inactive:hover { background-color: #f1f5f9; color: #334155; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto fade-in">
        <div class="text-center mb-8">
            <div class="flex items-center justify-center mb-2">
                <i data-lucide="calculator" class="w-8 h-8 mr-3 theme-purple-text" id="header-icon"></i>
                <h1 class="text-3xl font-bold text-gray-800 tracking-tight">åŒ…ç§Ÿä»£ç®¡å¤–åŒ…è©¦ç®—</h1>
            </div>
            <p class="text-gray-500">å¤–åŒ…è–ªé…¬çµç®—èˆ‡åˆ©æ½¤åˆ†æç³»çµ±</p>
        </div>

        <div class="flex rounded-t-xl overflow-hidden shadow-sm text-lg no-print">
            <button id="btn-sublet" onclick="switchMode('sublet')" class="flex-1 py-4 flex items-center justify-center font-bold transition-all duration-200 tab-active-sublet">
                <i data-lucide="building-2" class="w-5 h-5 mr-2"></i>
                æ¨¡å¼ Aï¼šåŒ…ç§Ÿè½‰ç§Ÿ
            </button>
            <button id="btn-manage" onclick="switchMode('manage')" class="flex-1 py-4 flex items-center justify-center font-bold transition-all duration-200 tab-inactive">
                <i data-lucide="briefcase" class="w-5 h-5 mr-2"></i>
                æ¨¡å¼ Bï¼šä»£ç®¡æœå‹™
            </button>
        </div>

        <div class="bg-white rounded-b-xl shadow-lg p-6 md:p-8 mb-6 border border-gray-100">
            
            <div class="flex items-center mb-6">
                <div class="w-1.5 h-8 theme-purple-bg mr-3 rounded-full" id="section-bar"></div>
                <h3 class="text-xl font-bold text-gray-800" id="section-title">è©¦ç®—æ¢ä»¶ï¼šåŒ…ç§Ÿè½‰ç§Ÿ</h3>
            </div>

            <div id="info-box" class="theme-purple-light-bg p-4 rounded-lg flex items-start mb-8 border border-transparent">
                <i data-lucide="info" class="w-5 h-5 theme-purple-text mr-3 mt-0.5 flex-shrink-0" id="info-icon"></i>
                <p class="text-sm text-gray-700 font-medium" id="info-text">èªªæ˜ï¼šå…¬å¸æ‰¿ç§Ÿç‰©ä»¶å¾Œè½‰ç§Ÿï¼Œè³ºå–ç§Ÿé‡‘åƒ¹å·®ã€‚</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                
                <div class="input-group sublet-only">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="building" class="w-4 h-4 mr-2 theme-purple-text"></i>
                        æ¯æœˆæ‰¿ç§Ÿæˆæœ¬
                    </label>
                    <input type="number" id="sublet_cost" placeholder="20000" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition text-lg bg-gray-50 focus:bg-white" oninput="calculate()">
                    <p class="text-xs text-gray-400 mt-1 pl-1">å…¬å¸ä»˜çµ¦æˆ¿æ±çš„ç§Ÿé‡‘</p>
                </div>
                <div class="input-group sublet-only">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="dollar-sign" class="w-4 h-4 mr-2 theme-purple-text"></i>
                        æ¯æœˆç¸½ç§Ÿé‡‘æ”¶å…¥
                    </label>
                    <input type="number" id="sublet_revenue" placeholder="45000" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition text-lg bg-gray-50 focus:bg-white" oninput="calculate()">
                    <p class="text-xs text-gray-400 mt-1 pl-1">å‘æˆ¿å®¢æ”¶å–çš„ç¸½é‡‘é¡</p>
                </div>
                <div class="input-group sublet-only md:col-span-2">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="percent" class="w-4 h-4 mr-2 theme-purple-text"></i>
                        å¤–åŒ…ç®¡ç†è²»ç‡ (%)
                    </label>
                    <div class="relative">
                        <input type="number" id="sublet_rate" placeholder="10" value="10" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition text-lg pr-12 bg-gray-50 focus:bg-white" oninput="calculate()">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none text-gray-400 font-bold">%</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-1 pl-1">çµ¦æ¥­å‹™/ç®¡ç†å“¡çš„æ¯”ä¾‹</p>
                </div>

                <div class="input-group manage-only hidden">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="home" class="w-4 h-4 mr-2 theme-green-text"></i>
                        ç‰©ä»¶æœˆç§Ÿé‡‘
                    </label>
                    <input type="number" id="manage_rent" placeholder="30000" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-lg bg-gray-50 focus:bg-white" oninput="calculate()">
                    <p class="text-xs text-gray-400 mt-1 pl-1">æˆ¿å®¢å¯¦éš›ç¹³äº¤çš„ç§Ÿé‡‘</p>
                </div>
                <div class="input-group manage-only hidden">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="percent" class="w-4 h-4 mr-2 theme-green-text"></i>
                        å‘æˆ¿æ±æ”¶æœå‹™è²»ç‡ (%)
                    </label>
                    <div class="relative">
                        <input type="number" id="manage_fee_rate" placeholder="15" value="15" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-lg pr-12 bg-gray-50 focus:bg-white" oninput="calculate()">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none text-gray-400 font-bold">%</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-1 pl-1">å‘æˆ¿æ±æ”¶å–çš„%æ•¸</p>
                </div>
                <div class="input-group manage-only hidden md:col-span-2">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="handshake" class="w-4 h-4 mr-2 theme-green-text"></i>
                        å¤–åŒ…åˆ†æ½¤æ¯”ä¾‹ (%)
                    </label>
                    <div class="relative">
                        <input type="number" id="manage_split_rate" placeholder="50" value="50" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-lg pr-12 bg-gray-50 focus:bg-white" oninput="calculate()">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none text-gray-400 font-bold">%</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-1 pl-1">å°‡æœå‹™è²»åˆ†çµ¦å¤–åŒ…çš„æ¯”ä¾‹ (50% = å°åˆ†)</p>
                </div>
            </div>

            <hr class="border-gray-100 mb-8">

            <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 gap-6 opacity-60 transition-all duration-300">
                
                <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200 hover:shadow-lg transition">
                    <div class="bg-slate-700 p-4 flex items-center text-white">
                        <i data-lucide="file-text" class="w-5 h-5 mr-2"></i>
                        <h4 class="font-bold tracking-wide">1. ä»˜æ¬¾çµç®—å–® (çµ¦å‡ºç´)</h4>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600 font-medium">å¤–åŒ…è²»ç”¨ (ç¨…å‰)</span>
                            <span class="font-bold text-lg font-mono text-gray-800" id="res_gross">$0</span>
                        </div>
                        <div class="flex justify-between items-center text-rose-500">
                            <span class="flex items-center"><i data-lucide="minus-circle" class="w-3 h-3 mr-1"></i> ä»£æ‰£æ‰€å¾—ç¨… (10%)</span>
                            <span class="font-bold font-mono" id="res_tax">-$0</span>
                        </div>
                        <div class="flex justify-between items-center text-rose-500">
                            <span class="flex items-center"><i data-lucide="minus-circle" class="w-3 h-3 mr-1"></i> äºŒä»£å¥ä¿ (2.11%)</span>
                            <span class="font-bold font-mono" id="res_health">-$0</span>
                        </div>
                        <div class="border-t border-dashed border-gray-300 my-2"></div>
                        <div class="flex justify-between items-center bg-blue-50 p-3 rounded-lg -mx-2">
                            <span class="text-blue-800 font-bold text-sm">æ‡‰åŒ¯æ¬¾é‡‘é¡ (Net Pay)</span>
                            <span class="font-bold text-2xl text-blue-700 font-mono" id="res_net_pay">$0</span>
                        </div>
                        <div id="tax_warning" class="hidden text-xs text-rose-600 bg-rose-50 p-2 rounded text-center">
                            âš ï¸ å·²é” $20,000 é–€æª»ï¼Œç³»çµ±è‡ªå‹•å•Ÿå‹•æ‰£ç¹³æ©Ÿåˆ¶
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200 hover:shadow-lg transition">
                    <div class="bg-slate-800 p-4 flex items-center text-white">
                        <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i>
                        <h4 class="font-bold tracking-wide">2. åˆ©æ½¤åˆ†æ (è€é—†å°ˆç”¨)</h4>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600 font-medium">å…¬å¸æœªç¨…ç‡Ÿæ”¶ (Ã·1.05)</span>
                            <span class="font-bold text-lg font-mono text-gray-800" id="res_comp_rev">$0</span>
                        </div>
                        <div class="flex justify-between items-center text-rose-500">
                            <span class="flex items-center"><i data-lucide="minus-circle" class="w-3 h-3 mr-1"></i> ç¸½æˆæœ¬ (ç§Ÿé‡‘+å¤–åŒ…)</span>
                            <span class="font-bold font-mono" id="res_total_cost">-$0</span>
                        </div>
                        
                        <div class="border-t border-dashed border-gray-300 my-2"></div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-gray-800 font-bold">å…¬å¸æ·¨åˆ© (Net Profit)</span>
                            <span class="font-bold text-2xl font-mono theme-purple-text" id="res_profit">$0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600 text-sm">æ¯›åˆ©ç‡ (Margin)</span>
                            <span class="font-bold text-lg theme-purple-text" id="res_margin">0.0%</span>
                        </div>
                        <div id="margin_warning" class="hidden text-xs text-amber-700 bg-amber-50 p-2 rounded text-center">
                            âš ï¸ è­¦å‘Šï¼šæ¯›åˆ©ç‡éä½ (<20%)ï¼Œå»ºè­°èª¿æ•´åˆ†æ½¤æ¯”ä¾‹
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-right text-xs text-gray-400 mt-6 pt-4 border-t border-gray-100" id="timestamp">
                æœ€å¾Œè©¦ç®—: ---
            </div>

        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 no-print">
            <button onclick="window.print()" class="bg-rose-600 hover:bg-rose-700 text-white font-bold py-4 rounded-xl flex items-center justify-center transition shadow-md active:scale-95">
                <i data-lucide="file-down" class="w-5 h-5 mr-2"></i>
                åŒ¯å‡º / åˆ—å° PDF
            </button>
            <button onclick="shareLine()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl flex items-center justify-center transition shadow-md active:scale-95">
                <i data-lucide="share-2" class="w-5 h-5 mr-2"></i>
                æˆªåœ–åˆ†äº« LINE
            </button>
        </div>

        <footer class="text-center text-gray-400 text-sm mb-8 no-print">
            <p>Â© 2026 Rental Management System. All rights reserved.</p>
            <p class="mt-1 text-xs">ä¾æ“šä¸­è¯æ°‘åœ‹ç¨…æ³•è¨ˆç®— (æ‰€å¾—ç¨…10% / äºŒä»£å¥ä¿2.11%)</p>
        </footer>

    </div>

    <script>
        // åˆå§‹åŒ–åœ–æ¨™
        lucide.createIcons();

        let currentMode = 'sublet'; // é è¨­æ¨¡å¼

        // åˆ‡æ›æ¨¡å¼å‡½æ•¸
        function switchMode(mode) {
            currentMode = mode;
            const isSublet = mode === 'sublet';

            // 1. æ›´æ–° Tabs æŒ‰éˆ•æ¨£å¼
            const btnSublet = document.getElementById('btn-sublet');
            const btnManage = document.getElementById('btn-manage');
            
            if (isSublet) {
                btnSublet.className = "flex-1 py-4 flex items-center justify-center font-bold transition-all duration-200 tab-active-sublet";
                btnManage.className = "flex-1 py-4 flex items-center justify-center font-bold transition-all duration-200 tab-inactive";
            } else {
                btnSublet.className = "flex-1 py-4 flex items-center justify-center font-bold transition-all duration-200 tab-inactive";
                btnManage.className = "flex-1 py-4 flex items-center justify-center font-bold transition-all duration-200 tab-active-manage";
            }

            // 2. æ›´æ–°ä¸»é¡Œé¡è‰² (é€é classList replace)
            const themeColor = isSublet ? 'purple' : 'green';
            const prevColor = isSublet ? 'green' : 'purple';
            
            // æ¨™é¡Œæ£’èˆ‡ InfoBox
            updateThemeClasses('section-bar', prevColor, themeColor, 'bg');
            updateThemeClasses('info-box', prevColor, themeColor, 'light-bg');
            updateThemeClasses('info-icon', prevColor, themeColor, 'text');
            updateThemeClasses('header-icon', prevColor, themeColor, 'text');
            
            // 3. æ›´æ–°å…§å®¹é¡¯ç¤º
            if (isSublet) {
                document.getElementById('section-title').innerText = "è©¦ç®—æ¢ä»¶ï¼šåŒ…ç§Ÿè½‰ç§Ÿ";
                document.getElementById('info-text').innerText = "èªªæ˜ï¼šå…¬å¸æ‰¿ç§Ÿç‰©ä»¶å¾Œè½‰ç§Ÿï¼Œè³ºå–ç§Ÿé‡‘åƒ¹å·®ã€‚";
                
                document.querySelectorAll('.sublet-only').forEach(el => el.classList.remove('hidden'));
                document.querySelectorAll('.manage-only').forEach(el => el.classList.add('hidden'));
            } else {
                document.getElementById('section-title').innerText = "è©¦ç®—æ¢ä»¶ï¼šä»£ç®¡æœå‹™";
                document.getElementById('info-text').innerText = "èªªæ˜ï¼šå…¬å¸å¹«æˆ¿æ±ç®¡ç†ï¼Œè³ºå–æœå‹™è²»å¾Œèˆ‡å¤–åŒ…æ‹†å¸³ã€‚";
                
                document.querySelectorAll('.sublet-only').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.manage-only').forEach(el => el.classList.remove('hidden'));
            }
            
            // é‡æ–°è¨ˆç®—ä»¥æ›´æ–°çµæœå€é¡è‰²
            calculate();
        }

        // è¼”åŠ©å‡½æ•¸ï¼šæ›´æ–°ä¸»é¡Œ Class
        function updateThemeClasses(id, prev, current, type) {
            const el = document.getElementById(id);
            el.classList.replace(`theme-${prev}-${type}`, `theme-${current}-${type}`);
        }

        // æ ¸å¿ƒè¨ˆç®—å‡½æ•¸
        function calculate() {
            // ç¨…å‹™åƒæ•¸
            const VAT_RATE = 0.05; // ç‡Ÿæ¥­ç¨… 5%
            const TAX_THRESHOLD = 20000; // æ‰£ç¹³é–€æª» > 20000
            const HEALTH_THRESHOLD = 20000; // äºŒä»£å¥ä¿é–€æª» >= 20000
            
            let grossOutsourceFee = 0;
            let companyNetRevenue = 0;
            let totalCost = 0;

            const resultsContainer = document.getElementById('results-container');
            
            // è®€å–æ•¸å€¼ (è‹¥ç‚º NaN å‰‡è¨­ç‚º 0)
            if (currentMode === 'sublet') {
                const cost = parseFloat(document.getElementById('sublet_cost').value) || 0;
                const revenue = parseFloat(document.getElementById('sublet_revenue').value) || 0;
                const rate = parseFloat(document.getElementById('sublet_rate').value) || 0;

                // è‹¥æœªè¼¸å…¥ï¼Œç¨å¾®æ·¡åŒ–çµæœå€
                if (cost === 0 && revenue === 0) { resultsContainer.classList.add('opacity-60'); } 
                else { resultsContainer.classList.remove('opacity-60'); }

                // è¨ˆç®—é‚è¼¯ A
                grossOutsourceFee = revenue * (rate / 100);
                companyNetRevenue = Math.round(revenue / (1 + VAT_RATE));
                totalCost = cost + grossOutsourceFee;

            } else {
                const rent = parseFloat(document.getElementById('manage_rent').value) || 0;
                const feeRate = parseFloat(document.getElementById('manage_fee_rate').value) || 0;
                const splitRate = parseFloat(document.getElementById('manage_split_rate').value) || 0;

                if (rent === 0) { resultsContainer.classList.add('opacity-60'); }
                else { resultsContainer.classList.remove('opacity-60'); }

                // è¨ˆç®—é‚è¼¯ B
                const companyRevenueWithTax = rent * (feeRate / 100);
                grossOutsourceFee = companyRevenueWithTax * (splitRate / 100);
                companyNetRevenue = Math.round(companyRevenueWithTax / (1 + VAT_RATE));
                totalCost = grossOutsourceFee;
            }

            // ç¨…å‹™è¨ˆç®— (æ‰€å¾—ç¨… & äºŒä»£å¥ä¿)
            let tax = 0;
            let health = 0;
            
            // åš´æ ¼å¤§æ–¼ 20000 æ‰æ‰£ 10%
            if (grossOutsourceFee > TAX_THRESHOLD) { tax = Math.round(grossOutsourceFee * 0.10); }
            
            // å¤§æ–¼ç­‰æ–¼ 20000 å°±æ‰£ 2.11%
            if (grossOutsourceFee >= HEALTH_THRESHOLD) { health = Math.round(grossOutsourceFee * 0.0211); }

            const netPay = Math.round(grossOutsourceFee - tax - health);
            const profit = Math.round(companyNetRevenue - totalCost);
            
            // æ¯›åˆ©ç‡è¨ˆç®—
            let margin = (companyNetRevenue > 0) ? (profit / companyNetRevenue) * 100 : 0;

            // --- æ›´æ–° DOM é¡¯ç¤º ---
            const fmt = (n) => new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(n);
            
            // 1. å‡ºç´å¡ç‰‡
            document.getElementById('res_gross').innerText = fmt(grossOutsourceFee);
            document.getElementById('res_tax').innerText = tax > 0 ? `-${fmt(tax)}` : '-$0';
            document.getElementById('res_health').innerText = health > 0 ? `-${fmt(health)}` : '-$0';
            document.getElementById('res_net_pay').innerText = fmt(netPay);
            
            // é¡¯ç¤ºç¨…å‹™è­¦å‘Š
            const taxWarn = document.getElementById('tax_warning');
            if (tax > 0 || health > 0) { taxWarn.classList.remove('hidden'); } else { taxWarn.classList.add('hidden'); }

            // 2. è€é—†å¡ç‰‡
            document.getElementById('res_comp_rev').innerText = fmt(companyNetRevenue);
            document.getElementById('res_total_cost').innerText = totalCost > 0 ? `-${fmt(totalCost)}` : '-$0';
            
            // è¨­å®šåˆ©æ½¤é¡è‰² (è·Ÿéš¨ä¸»é¡Œ)
            const profitElem = document.getElementById('res_profit');
            const marginElem = document.getElementById('res_margin');
            
            const themeColorClass = currentMode === 'sublet' ? 'theme-purple-text' : 'theme-green-text';
            const profitValueClass = profit >= 0 ? themeColorClass : 'text-rose-600';
            
            // æ¸…é™¤èˆŠè‰²ï¼Œä¸Šæ–°è‰²
            profitElem.className = `font-bold text-2xl font-mono ${profitValueClass}`;
            profitElem.innerText = fmt(profit);

            marginElem.className = `font-bold text-lg ${profit >= 20 ? themeColorClass : 'text-rose-600'}`;
            marginElem.innerText = margin.toFixed(1) + "%";

            // åˆ©æ½¤è­¦å‘Š
            const marginWarn = document.getElementById('margin_warning');
            if (margin < 20 && companyNetRevenue > 0) { marginWarn.classList.remove('hidden'); } else { marginWarn.classList.add('hidden'); }

            // æ›´æ–°æ™‚é–“
            updateTimestamp();
        }

        // æ›´æ–°æ™‚é–“æˆ³è¨˜
        function updateTimestamp() {
            const now = new Date();
            const str = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
            document.getElementById('timestamp').innerText = `æœ€å¾Œè©¦ç®—: ${str}`;
        }

        // åˆ†äº«æŒ‰éˆ•æç¤º
        function shareLine() {
            alert("ğŸ’¡ æˆªåœ–åˆ†äº«æç¤ºï¼š\n\nè«‹ä½¿ç”¨æ‰‹æ©Ÿæˆªåœ–åŠŸèƒ½ï¼Œå°‡è¨ˆç®—çµæœç•«é¢æˆªåœ–å¾Œï¼Œç›´æ¥åˆ†äº«è‡³ LINE å°è©±çª—å³å¯ã€‚");
        }

        // åˆå§‹åŒ–
        calculate();
    </script>
</body>
</html>
