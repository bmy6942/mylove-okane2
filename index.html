<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rental Management Profit Calculator - åŒ…ç§Ÿä»£ç®¡å¤–åŒ…è©¦ç®—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Microsoft JhengHei', -apple-system, BlinkMacSystemFont, sans-serif; background-color: #f8fafc; }
        .no-spinner::-webkit-inner-spin-button, .no-spinner::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .no-spinner { -moz-appearance: textfield; }
        
        /* è‡ªå®šç¾©ä¸»é¡Œè‰² */
        .theme-purple-bg { background-color: #6366f1; } /* Indigo-500 */
        .theme-purple-text { color: #6366f1; }
        .theme-purple-border { border-color: #6366f1; }
        .theme-purple-light-bg { background-color: #e0e7ff; } /* Indigo-100 */

        .theme-green-bg { background-color: #10b981; } /* Emerald-500 */
        .theme-green-text { color: #10b981; }
        .theme-green-border { border-color: #10b981; }
        .theme-green-light-bg { background-color: #d1fae5; } /* Emerald-100 */

        /* Tab active states */
        .tab-active-sublet { background-color: #6366f1; color: white; }
        .tab-active-manage { background-color: #10b981; color: white; }
        .tab-inactive { background-color: white; color: #64748b; border: 1px solid #e2e8f0; }
        .tab-inactive:hover { background-color: #f1f5f9; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-lg font-medium text-gray-500">Rental Management Profit Calculator</h1>
            <div class="flex items-center justify-center mt-2">
                <i data-lucide="calculator" class="w-8 h-8 mr-3 theme-purple-text" id="header-icon"></i>
                <h2 class="text-3xl font-bold text-gray-800">åŒ…ç§Ÿä»£ç®¡å¤–åŒ…è©¦ç®—</h2>
            </div>
            <p class="text-gray-500 mt-2">å¤–åŒ…è–ªé…¬çµç®—èˆ‡åˆ©æ½¤åˆ†æå°ˆæ¥­ç‰ˆ</p>
        </div>

        <div class="flex rounded-t-xl overflow-hidden shadow-sm">
            <button id="btn-sublet" onclick="switchMode('sublet')" class="flex-1 py-4 flex items-center justify-center font-bold text-lg transition-all tab-active-sublet">
                <i data-lucide="building-2" class="w-5 h-5 mr-2"></i>
                æ¨¡å¼ Aï¼šåŒ…ç§Ÿè½‰ç§Ÿ
            </button>
            <button id="btn-manage" onclick="switchMode('manage')" class="flex-1 py-4 flex items-center justify-center font-bold text-lg transition-all tab-inactive">
                <i data-lucide="briefcase" class="w-5 h-5 mr-2"></i>
                æ¨¡å¼ Bï¼šä»£ç®¡æœå‹™
            </button>
        </div>

        <div class="bg-white rounded-b-xl shadow-lg p-6 md:p-8 mb-6">
            
            <div class="flex items-center mb-6">
                <div class="w-1 h-8 theme-purple-bg mr-3 rounded-full" id="section-bar"></div>
                <h3 class="text-xl font-bold text-gray-800" id="section-title">è©¦ç®—æ¢ä»¶ï¼šåŒ…ç§Ÿè½‰ç§Ÿ</h3>
            </div>

            <div id="info-box" class="theme-purple-light-bg p-4 rounded-lg flex items-start mb-8">
                <i data-lucide="info" class="w-5 h-5 theme-purple-text mr-3 mt-0.5 flex-shrink-0" id="info-icon"></i>
                <p class="text-sm text-gray-700" id="info-text">èªªæ˜ï¼šå…¬å¸æ‰¿ç§Ÿç‰©ä»¶å¾Œè½‰ç§Ÿï¼Œè³ºå–ç§Ÿé‡‘åƒ¹å·®ã€‚</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                
                <div class="input-group sublet-only">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="building" class="w-4 h-4 mr-2 theme-purple-text"></i>
                        æ¯æœˆæ‰¿ç§Ÿæˆæœ¬
                    </label>
                    <input type="number" id="sublet_cost" placeholder="20000" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition text-lg" oninput="calculate()">
                    <p class="text-xs text-gray-500 mt-1">å…¬å¸ä»˜çµ¦æˆ¿æ±çš„ç§Ÿé‡‘</p>
                </div>
                <div class="input-group sublet-only">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="dollar-sign" class="w-4 h-4 mr-2 theme-purple-text"></i>
                        æ¯æœˆç¸½ç§Ÿé‡‘æ”¶å…¥
                    </label>
                    <input type="number" id="sublet_revenue" placeholder="45000" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition text-lg" oninput="calculate()">
                    <p class="text-xs text-gray-500 mt-1">å‘æˆ¿å®¢æ”¶å–çš„ç¸½é‡‘é¡</p>
                </div>
                <div class="input-group sublet-only md:col-span-2">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="percent" class="w-4 h-4 mr-2 theme-purple-text"></i>
                        å¤–åŒ…ç®¡ç†è²»ç‡
                    </label>
                    <div class="relative">
                        <input type="number" id="sublet_rate" placeholder="10" value="10" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition text-lg pr-12" oninput="calculate()">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none text-gray-500 font-bold">%</div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">çµ¦æ¥­å‹™/ç®¡ç†å“¡çš„æ¯”ä¾‹</p>
                </div>

                <div class="input-group manage-only hidden">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="home" class="w-4 h-4 mr-2 theme-green-text"></i>
                        ç‰©ä»¶æœˆç§Ÿé‡‘
                    </label>
                    <input type="number" id="manage_rent" placeholder="30000" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-lg" oninput="calculate()">
                    <p class="text-xs text-gray-500 mt-1">æˆ¿å®¢å¯¦éš›ç¹³äº¤çš„ç§Ÿé‡‘</p>
                </div>
                <div class="input-group manage-only hidden">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="percent" class="w-4 h-4 mr-2 theme-green-text"></i>
                        æœå‹™è²»ç‡
                    </label>
                    <div class="relative">
                        <input type="number" id="manage_fee_rate" placeholder="15" value="15" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-lg pr-12" oninput="calculate()">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none text-gray-500 font-bold">%</div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">å‘æˆ¿æ±æ”¶å–çš„%æ•¸</p>
                </div>
                <div class="input-group manage-only hidden md:col-span-2">
                    <label class="flex items-center font-bold text-gray-700 mb-2">
                        <i data-lucide="handshake" class="w-4 h-4 mr-2 theme-green-text"></i>
                        å¤–åŒ…åˆ†æ½¤æ¯”ä¾‹
                    </label>
                    <div class="relative">
                        <input type="number" id="manage_split_rate" placeholder="50" value="50" class="no-spinner w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-lg pr-12" oninput="calculate()">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none text-gray-500 font-bold">%</div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">å°‡æœå‹™è²»åˆ†çµ¦å¤–åŒ…çš„æ¯”ä¾‹</p>
                </div>
            </div>

            <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 gap-6 opacity-50 transition-all">
                
                <div class="bg-white rounded-xl shadow overflow-hidden border border-gray-100">
                    <div class="bg-blue-600 p-4 flex items-center text-white">
                        <i data-lucide="file-text" class="w-5 h-5 mr-2"></i>
                        <h4 class="font-bold">1. ä»˜æ¬¾çµç®—å–® (çµ¦å‡ºç´)</h4>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">å¤–åŒ…è²»ç”¨ (Gross)</span>
                            <span class="font-bold text-lg font-mono" id="res_gross">$0</span>
                        </div>
                        <div class="flex justify-between items-center text-red-500">
                            <span>(-) ä»£æ‰£æ‰€å¾—ç¨… (10%)</span>
                            <span class="font-bold font-mono" id="res_tax">-$0</span>
                        </div>
                        <div class="flex justify-between items-center text-red-500">
                            <span>(-) äºŒä»£å¥ä¿ (2.11%)</span>
                            <span class="font-bold font-mono" id="res_health">-$0</span>
                        </div>
                        <div class="border-t border-gray-100 my-2"></div>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-800 font-bold">æ‡‰åŒ¯æ¬¾é‡‘é¡ (Net Pay)</span>
                            <span class="font-bold text-2xl text-blue-600 font-mono" id="res_net_pay">$0</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow overflow-hidden border border-gray-100">
                    <div class="bg-gray-800 p-4 flex items-center text-white">
                        <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i>
                        <h4 class="font-bold">2. åˆ©æ½¤åˆ†æ (è€é—†å°ˆç”¨)</h4>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">å…¬å¸æœªç¨…ç‡Ÿæ”¶ (/1.05)</span>
                            <span class="font-bold text-lg font-mono" id="res_comp_rev">$0</span>
                        </div>
                        <div class="flex justify-between items-center text-red-500">
                            <span>(-) ç¸½æˆæœ¬ (ç§Ÿé‡‘+å¤–åŒ…)</span>
                            <span class="font-bold font-mono" id="res_total_cost">-$0</span>
                        </div>
                        <div class="hidden pl-4 text-sm text-gray-500 space-y-1">
                            <div class="flex justify-between"><span>æ‰¿ç§Ÿæˆæœ¬:</span><span id="detail_rent_cost">$0</span></div>
                            <div class="flex justify-between"><span>å¤–åŒ…è²»ç”¨:</span><span id="detail_outsource_cost">$0</span></div>
                        </div>
                        
                        <div class="border-t border-gray-100 my-2"></div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-800 font-bold">å…¬å¸æ·¨åˆ© (Net Profit)</span>
                            <span class="font-bold text-2xl font-mono theme-purple-text" id="res_profit">$0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">æ¯›åˆ©ç‡ (Margin)</span>
                            <span class="font-bold text-lg theme-purple-text" id="res_margin">0.0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-right text-xs text-gray-400 mt-4" id="timestamp">
                è©¦ç®—æ—¥æœŸ: ---
            </div>

        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            <button onclick="exportPDF()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl flex items-center justify-center transition shadow-md">
                <i data-lucide="file-down" class="w-5 h-5 mr-2"></i>
                åŒ¯å‡º PDF
            </button>
            <button onclick="shareLine()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl flex items-center justify-center transition shadow-md">
                <i data-lucide="share-2" class="w-5 h-5 mr-2"></i>
                åˆ†äº« LINE åœ–ç‰‡
            </button>
        </div>

        <footer class="text-center text-gray-500 text-sm mb-8">
            <p>Â© 2026 Rental Management System. All rights reserved.</p>
            <p class="mt-1">ä¾æ“šä¸­è¯æ°‘åœ‹ç¨…æ³•è¨ˆç®— (æ‰€å¾—ç¨…10% / äºŒä»£å¥ä¿2.11%)</p>
        </footer>

    </div>

    <script>
        // åˆå§‹åŒ–åœ–æ¨™
        lucide.createIcons();

        let currentMode = 'sublet'; // é è¨­æ¨¡å¼

        function switchMode(mode) {
            currentMode = mode;
            const isSublet = mode === 'sublet';

            // 1. æ›´æ–° Tabs æ¨£å¼
            const btnSublet = document.getElementById('btn-sublet');
            const btnManage = document.getElementById('btn-manage');
            
            btnSublet.className = isSublet ? "flex-1 py-4 flex items-center justify-center font-bold text-lg transition-all tab-active-sublet" : "flex-1 py-4 flex items-center justify-center font-bold text-lg transition-all tab-inactive";
            btnManage.className = !isSublet ? "flex-1 py-4 flex items-center justify-center font-bold text-lg transition-all tab-active-manage" : "flex-1 py-4 flex items-center justify-center font-bold text-lg transition-all tab-inactive";

            // 2. æ›´æ–°ä¸»é¡Œé¡è‰² (æ¨™é¡Œæ£’, Info Box, Icon, è€é—†çµæœæ–‡å­—)
            const themeColor = isSublet ? 'purple' : 'green';
            const otherColor = isSublet ? 'green' : 'purple';
            
            document.getElementById('section-bar').classList.replace(`theme-${otherColor}-bg`, `theme-${themeColor}-bg`);
            document.getElementById('info-box').classList.replace(`theme-${otherColor}-light-bg`, `theme-${themeColor}-light-bg`);
            document.getElementById('info-icon').classList.replace(`theme-${otherColor}-text`, `theme-${themeColor}-text`);
            document.getElementById('header-icon').classList.replace(`theme-${otherColor}-text`, `theme-${themeColor}-text`);
            
            const profitText = document.getElementById('res_profit');
            profitText.classList.remove(`theme-${otherColor}-text`, 'text-red-600');
            profitText.classList.add(`theme-${themeColor}-text`);
            
            const marginText = document.getElementById('res_margin');
            marginText.classList.remove(`theme-${otherColor}-text`, 'text-red-600');
            marginText.classList.add(`theme-${themeColor}-text`);


            // 3. æ›´æ–°å…§å®¹æ–‡å­—èˆ‡é¡¯ç¤ºè¼¸å…¥æ¬„ä½
            if (isSublet) {
                document.getElementById('section-title').innerText = "è©¦ç®—æ¢ä»¶ï¼šåŒ…ç§Ÿè½‰ç§Ÿ";
                document.getElementById('info-text').innerText = "èªªæ˜ï¼šå…¬å¸æ‰¿ç§Ÿç‰©ä»¶å¾Œè½‰ç§Ÿï¼Œè³ºå–ç§Ÿé‡‘åƒ¹å·®ã€‚";
                document.querySelectorAll('.sublet-only').forEach(el => el.classList.remove('hidden'));
                document.querySelectorAll('.manage-only').forEach(el => el.classList.add('hidden'));
            } else {
                document.getElementById('section-title').innerText = "è©¦ç®—æ¢ä»¶ï¼šä»£ç®¡æœå‹™";
                document.getElementById('info-text').innerText = "èªªæ˜ï¼šå…¬å¸å¹«æˆ¿æ±ç®¡ç†ï¼Œè³ºå–æœå‹™è²»å¾Œèˆ‡å¤–åŒ…æ‹†å¸³ã€‚";
                document.querySelectorAll('.sublet-only').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.manage-only').forEach(el => el.classList.remove('hidden'));
            }
            
            calculate();
        }

        function calculate() {
            const VAT_RATE = 0.05;
            const TAX_THRESHOLD = 20000;
            const HEALTH_THRESHOLD = 20000;
            
            let grossOutsourceFee = 0;
            let companyNetRevenue = 0;
            let totalCost = 0;
            // let rentCostDetail = 0; // For detailed view if needed

            const resultsContainer = document.getElementById('results-container');

            if (currentMode === 'sublet') {
                const cost = parseFloat(document.getElementById('sublet_cost').value) || 0;
                const revenue = parseFloat(document.getElementById('sublet_revenue').value) || 0;
                const rate = parseFloat(document.getElementById('sublet_rate').value) || 0;

                if (cost === 0 && revenue === 0) {
                    resultsContainer.classList.add('opacity-50'); return;
                }
                resultsContainer.classList.remove('opacity-50');

                grossOutsourceFee = revenue * (rate / 100);
                companyNetRevenue = Math.round(revenue / (1 + VAT_RATE));
                totalCost = cost + grossOutsourceFee;
                // rentCostDetail = cost;

            } else {
                const rent = parseFloat(document.getElementById('manage_rent').value) || 0;
                const feeRate = parseFloat(document.getElementById('manage_fee_rate').value) || 0;
                const splitRate = parseFloat(document.getElementById('manage_split_rate').value) || 0;

                if (rent === 0) {
                     resultsContainer.classList.add('opacity-50'); return;
                }
                resultsContainer.classList.remove('opacity-50');

                const companyRevenueWithTax = rent * (feeRate / 100);
                grossOutsourceFee = companyRevenueWithTax * (splitRate / 100);
                companyNetRevenue = Math.round(companyRevenueWithTax / (1 + VAT_RATE));
                totalCost = grossOutsourceFee;
                // rentCostDetail = 0;
            }

            // ç¨…å‹™è¨ˆç®—
            let tax = 0;
            let health = 0;
            if (grossOutsourceFee > TAX_THRESHOLD) { tax = Math.round(grossOutsourceFee * 0.10); }
            if (grossOutsourceFee >= HEALTH_THRESHOLD) { health = Math.round(grossOutsourceFee * 0.0211); }

            const netPay = Math.round(grossOutsourceFee - tax - health);
            const profit = Math.round(companyNetRevenue - totalCost);
            let margin = (companyNetRevenue > 0) ? (profit / companyNetRevenue) * 100 : 0;

            // æ›´æ–°ç•«é¢
            const fmt = (n) => new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(n);
            
            // å‡ºç´å¡ç‰‡
            document.getElementById('res_gross').innerText = fmt(grossOutsourceFee);
            document.getElementById('res_tax').innerText = tax > 0 ? `-${fmt(tax)}` : '-$0';
            document.getElementById('res_health').innerText = health > 0 ? `-${fmt(health)}` : '-$0';
            document.getElementById('res_net_pay').innerText = fmt(netPay);
            
            // è€é—†å¡ç‰‡
            document.getElementById('res_comp_rev').innerText = fmt(companyNetRevenue);
            document.getElementById('res_total_cost').innerText = totalCost > 0 ? `-${fmt(totalCost)}` : '-$0';
            
            const profitElem = document.getElementById('res_profit');
            profitElem.innerText = fmt(profit);
            const themeColor = currentMode === 'sublet' ? 'theme-purple-text' : 'theme-green-text';
            profitElem.className = profit >= 0 ? `font-bold text-2xl font-mono ${themeColor}` : "font-bold text-2xl font-mono text-red-600";

            const marginElem = document.getElementById('res_margin');
            marginElem.innerText = margin.toFixed(1) + "%";
            marginElem.className = margin >= 0 ? `font-bold text-lg ${themeColor}` : "font-bold text-lg text-red-600";

            // æ›´æ–°æ™‚é–“æˆ³è¨˜
            const now = new Date();
            const dateStr = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getDate().toString().padStart(2,'0')}`;
            const timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
            document.getElementById('timestamp').innerText = `è©¦ç®—æ—¥æœŸ: ${dateStr} ${timeStr}`;
        }

        // åŒ¯å‡º PDF åŠŸèƒ½ (ä½¿ç”¨ç€è¦½å™¨åˆ—å°)
        function exportPDF() {
            window.print();
        }

        // åˆ†äº« LINE åœ–ç‰‡åŠŸèƒ½ (å‰ç«¯æ¨¡æ“¬)
        function shareLine() {
            alert("ğŸ’¡ åŠŸèƒ½æç¤ºï¼š\n\nç”±æ–¼é€™æ˜¯ä¸€å€‹éœæ…‹ç¶²é ï¼Œç„¡æ³•ç›´æ¥åœ¨å¾Œç«¯ç”Ÿæˆåœ–ç‰‡ä¸¦ä¸²æ¥ LINE åˆ†äº« APIã€‚\n\nå»ºè­°æ“ä½œæ–¹å¼ï¼š\nè«‹ç›´æ¥ä½¿ç”¨æ‰‹æ©Ÿæˆªåœ–åŠŸèƒ½ï¼Œå°‡è¨ˆç®—çµæœæˆªåœ–å¾Œï¼Œå†é€é LINE åˆ†äº«çµ¦å°æ–¹ã€‚");
        }

        // åˆå§‹åŒ–åŸ·è¡Œä¸€æ¬¡
        calculate();
    </script>
</body>
</html>